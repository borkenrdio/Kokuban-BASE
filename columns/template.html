<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GSSKLZ6EDH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-GSSKLZ6EDH');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>{{TITLE}}</title>
    <meta name="description" content="{{DESCRIPTION}}">
    <link rel="canonical" href="{{CANONICAL_URL}}">
    
    <meta property="og:type" content="article">
    <meta property="og:title" content="{{TITLE}}">
    <meta property="og:description" content="{{DESCRIPTION}}">
    <meta property="og:url" content="{{CANONICAL_URL}}">
    <meta property="og:image" content="{{OG_IMAGE_URL}}">
    <meta property="og:site_name" content="Kokuban BASE（コクバンベース）">
    <meta property="og:locale" content="ja_JP">
    <meta property="article:published_time" content="{{PUBLISHED_AT_ISO}}">
    <meta property="article:modified_time" content="{{UPDATED_AT_ISO}}">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{TITLE}}">
    <meta name="twitter:description" content="{{DESCRIPTION}}">
    <meta name="twitter:image" content="{{OG_IMAGE_URL}}">
    
    <script type="application/ld+json">
    [
        {
            "@context": "https://schema.org",
            "@type": "Article",
            "mainEntityOfPage": { "@type": "WebPage", "@id": "{{CANONICAL_URL}}" },
            "headline": "{{TITLE_PLAIN}}",
            "description": "{{DESCRIPTION}}",
            "image": ["{{OG_IMAGE_URL}}"],
            "datePublished": "{{PUBLISHED_AT_ISO}}",
            "dateModified": "{{UPDATED_AT_ISO}}",
            "author": { "@type": "Organization", "name": "Kokuban BASE（コクバンベース）", "url": "https://kokuban-base.com/" },
            "publisher": { 
                "@type": "Organization", 
                "name": "Kokuban BASE（コクバンベース）", 
                "logo": { "@type": "ImageObject", "url": "https://kokuban-base.com/ogp.jpg" } 
            }
        },
        {
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            "itemListElement": [
                { "@type": "ListItem", "position": 1, "name": "ホーム", "item": "https://kokuban-base.com/" },
                { "@type": "ListItem", "position": 2, "name": "コラム", "item": "https://kokuban-base.com/#news" },
                { "@type": "ListItem", "position": 3, "name": "{{TITLE_PLAIN}}", "item": "{{CANONICAL_URL}}" }
            ]
        }
    ]
    </script>

    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        customBlue: '#103f99',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+JP:wght@400;500;700;900&family=Noto+Serif+JP:wght@400;600;700&family=Roboto:wght@500&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; background-color: #ffffff; color: #333; }
        
        .title-block { text-align: center; }
        .title-block h1 { line-height: 1.5; }
        .title-block h1 .subtitle { font-size: 0.7em; font-weight: 500; color: #4b5563; }
        .title-block .publish-date { font-size: 0.875rem; color: #6b7280; }

        .article-body p { 
            line-height: 1.8; 
            margin-bottom: 1.8em; 
            letter-spacing: 0.05em;
        }

        .article-body br {
            display: none;
        }
        
        .article-body h2 { font-size: 1.875rem!important; line-height: 2.25rem!important; font-weight: 900; margin: 3.5em 0 1.2em; padding-bottom: 0.4em; border-bottom: 2px solid #f3f4f6; }
        .article-body h3 { font-size: 1.5rem!important; line-height: 2rem!important; }
        
        .speaker-a { color: #103F99; }
        .speaker-b { color: #EC4899; }
        .speaker-default { color: #374151; }

        .article-body img { max-width: 100%; height: auto; border-radius: 0.5rem; margin: 1.5rem auto; }
        .eyecatch-image img { width: 100%; height: auto; border-radius: 0.75rem; }

        /* --- 自動リンクカード（Slack風） --- */
        .blog-card-wrapper {
            margin: 2.5rem 0;
            width: 100%;
        }

        .blog-card {
            display: flex;
            align-items: stretch;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-left: 4px solid #103f99;
            border-radius: 6px;
            text-decoration: none !important;
            color: inherit !important;
            transition: all 0.2s ease-in-out;
            overflow: hidden;
            min-height: 120px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .blog-card:hover {
            background-color: #f9fafb;
            border-color: #d1d5db;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .blog-card-main {
            flex: 1;
            padding: 16px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 0;
        }

        .blog-card-site-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .blog-card-site-name {
            font-size: 12px;
            font-weight: 800;
            color: #4b5563;
            letter-spacing: 0.02em;
        }

        .blog-card-title {
            font-size: 16px;
            font-weight: 800;
            line-height: 1.5;
            color: #111827;
            margin-bottom: 6px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .blog-card-desc {
            font-size: 13.5px;
            color: #6b7280;
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .blog-card-thumb {
            width: 180px;
            min-width: 180px;
            background-color: #f3f4f6;
            border-left: 1px solid #f3f4f6;
        }

        .blog-card-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            margin: 0 !important;
            border-radius: 0 !important;
        }

        @media (max-width: 640px) {
            .blog-card-thumb { width: 100px; min-width: 100px; }
            .blog-card-title { font-size: 14px; }
            .blog-card-desc { display: none; }
            .blog-card-main { padding: 12px 16px; }
        }

        .text-shadow { text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3); }
        .bg-custom-blue { background-color: rgb(16, 63, 153); }
        .footer-link { color: #e5e7eb; transition: color 0.2s ease-in-out; }
        .footer-link:hover { color: #ffffff; text-decoration: underline; }
    </style>
</head>
<body class="bg-stone-50">

    <header id="page-header" class="bg-[#103f99] sticky top-0 z-20 transition-all duration-300">
        <div class="px-6 lg:px-8">
            <div class="flex items-stretch h-[50px] sm:h-20">
                <div class="flex-1 flex items-center space-x-8">
                    <div class="text-xl sm:text-2xl font-bold text-white text-shadow flex-shrink-0">
                        <a href="/" class="hover:opacity-80 transition-opacity">Kokuban BASE</a>
                    </div>
                </div>
                <div class="flex-shrink-0 flex items-center space-x-4">
                    <a href="/contact.html" class="hidden sm:block bg-white text-[#103f99] font-bold px-6 py-2 rounded hover:bg-gray-100 transition-colors">お問い合わせ</a>
                    <a href="/reservation.html" class="bg-pink-500 text-white font-bold px-6 py-2 rounded hover:bg-pink-600 transition-colors">来場予約</a>
                </div>
            </div>
        </div>
    </header>

    <main class="bg-white py-8 sm:py-16">
        <div id="detail-content-area" class="w-[95%] sm:w-[90%] md:max-w-screen-md lg:max-w-screen-lg mx-auto p-6 sm:p-10 bg-white rounded-lg">
            <article>
                <!-- アイキャッチ画像をタイトルの上に表示 -->
                <div class="eyecatch-image max-w-4xl mx-auto mb-10">
                    {{EYECATCH_HTML}}
                </div>

                <div class="title-block max-w-4xl mx-auto">
                    <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 mb-4 leading-tight">{{TITLE_HTML}}</h1>
                    <p class="publish-date mb-10 text-gray-500">公開日: {{PUBLISHED_AT_FORMATTED}}</p>
                </div>
                
                <div class="article-body text-lg text-gray-800 max-w-3xl mx-auto">
                    {{BODY_HTML}}
                </div>
            </article>

            <div class="mt-20 max-w-5xl mx-auto">
                <div class="flex items-center mb-8">
                    <h3 class="text-xl font-bold text-gray-900">あわせて読みたい</h3>
                    <div class="flex-1 h-px bg-gray-200 ml-6"></div>
                </div>
                <div id="related-posts-container" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_KEY = "{{MICROCMS_API_KEY}}";
            const SERVICE_DOMAIN = "{{MICROCMS_SERVICE_DOMAIN}}";
            const API_ENDPOINT = "news";

            // --- リンクカード自動生成処理 ---
            const convertLinksToCards = async () => {
                const links = document.querySelectorAll('.article-body a');
                
                for (const link of links) {
                    const url = link.href;
                    const text = link.textContent.trim();
                    
                    // 条件: リンクテキストがURL（またはプロトコルなしURL）と一致するか判定
                    const urlNoProto = url.replace(/^https?:\/\//, '').replace(/\/$/, '');
                    const textNoProto = text.replace(/^https?:\/\//, '').replace(/\/$/, '');
                    
                    const isRawUrl = textNoProto === urlNoProto;
                    
                    if (isRawUrl || link.classList.contains('js-blog-card')) {
                        // 内部リンク（kokuban-base.com/columns/ID）かどうか判定
                        const match = url.match(/\/columns\/([a-zA-Z0-9_-]+)/);
                        
                        // APIキーが設定されている場合のみ実行
                        if (match && match[1] && API_KEY && !API_KEY.includes('{{')) {
                            const contentId = match[1];
                            
                            try {
                                const res = await fetch(`https://${SERVICE_DOMAIN}.microcms.io/api/v1/${API_ENDPOINT}/${contentId}?fields=title,eyecatch`, {
                                    headers: { "X-MICROCMS-API-KEY": API_KEY }
                                });
                                if (!res.ok) continue;
                                const data = await res.json();
                                
                                const cardHtml = `
                                    <div class="blog-card-wrapper">
                                        <a href="${url}" class="blog-card" target="_blank">
                                            <div class="blog-card-main">
                                                <div class="blog-card-site-info">
                                                    <span class="blog-card-site-name">Kokuban BASE</span>
                                                </div>
                                                <div class="blog-card-title">${data.title}</div>
                                                <div class="blog-card-desc">Kokuban BASEのコラム記事です。電子黒板の導入や活用に役立つ情報を紹介しています。</div>
                                            </div>
                                            ${data.eyecatch ? `
                                            <div class="blog-card-thumb">
                                                <img src="${data.eyecatch.url}" alt="">
                                            </div>
                                            ` : ''}
                                        </a>
                                    </div>
                                `;
                                const div = document.createElement('div');
                                div.innerHTML = cardHtml;
                                link.parentNode.replaceChild(div.firstElementChild, link);
                            } catch (e) {
                                console.error("リンクカードの生成に失敗しました:", e);
                            }
                        }
                    }
                }
            };

            convertLinksToCards();

            // 話者アイコン処理
            const speakers = {  '竹山：': 'speaker-a', '近藤：': 'speaker-b', '高見：': 'speaker-c', '遠藤：': 'speaker-a', '萩原：': 'speaker-b', '関：': 'speaker-b', '鳥井：': 'speaker-b'  };
            document.querySelectorAll('.article-body p').forEach(p => {
                let el = p.querySelector('strong:first-child');
                if (el) {
                    const cls = speakers[el.textContent.trim()];
                    if (cls) el.classList.add(cls);
                }
            });
        });
    </script>
</body>
</html>
