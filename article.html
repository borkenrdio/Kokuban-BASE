<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- Google Tag Manager -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GSSKLZ6EDH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GSSKLZ6EDH');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>コラム一覧 | Kokuban BASE（コクバンベース）</title>
    <meta name="description" content="Kokuban BASEの最新コラム、対談記事、教育現場のICT活用事例をお届けします。">
    
    <!-- Fonts & Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; background-color: #fdfdfd; color: #333; }
        
        /* 共通カラー定義 */
        .text-custom-blue { color: #103f99; }
        .bg-custom-blue { background-color: #103f99; }
        .border-custom-blue { border-color: #103f99; }
        
        .text-custom-pink { color: #ec4899; }
        .bg-custom-pink { background-color: #ec4899; }
        .border-custom-pink { border-color: #ec4899; }
        
        .footer-link { color: #e5e7eb; transition: color 0.2s; }
        .footer-link:hover { color: #ffffff; text-decoration: underline; }

        /* カードアニメーション */
        .article-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .article-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
        
        .img-container { aspect-ratio: 16 / 9; overflow: hidden; }
        .img-container img { transition: transform 0.5s ease; }
        .article-card:hover .img-container img { transform: scale(1.05); }

        /* テキストシャドウ */
        .text-shadow { text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3); }
    </style>
</head>
<body class="bg-stone-50 flex flex-col min-h-screen">

    <!-- Header -->
    <header id="page-header" class="bg-[#103f99] sticky top-0 z-20 transition-colors duration-300 shadow-md">
        <div class="px-6 lg:px-8">
            <div class="flex items-stretch h-[50px] sm:h-20">
                <div class="flex-1 flex items-center space-x-8">
                    <div class="text-xl sm:text-2xl font-bold text-white text-shadow flex-shrink-0">
                        <a href="/" class="hover:opacity-80 transition-opacity">Kokuban BASE</a>
                    </div>
                    <nav class="hidden lg:flex items-center space-x-1 text-sm">
                        <a href="/#products" class="text-white font-semibold hover:opacity-80 transition-opacity text-shadow p-2">ラインナップ</a>
                        <a href="/#columns" class="text-white font-semibold hover:opacity-80 transition-opacity text-shadow p-2">コラム</a>
                        <a href="/#faq" class="text-white font-semibold hover:opacity-80 transition-opacity text-shadow p-2">よくある質問</a>
                        <a href="/#access" class="text-white font-semibold hover:opacity-80 transition-opacity text-shadow p-2">アクセス</a>
                    </nav>
                </div>
                <div class="flex-shrink-0 flex justify-end">
                    <div class="hidden sm:flex">
                        <a href="/contact" class="bg-white text-[#103f99] font-bold text-base lg:text-lg flex items-center justify-center w-full sm:w-36 lg:w-48 hover:bg-gray-100 transition-colors px-2">
                            <span>お問い合わせ</span><i class="fa-solid fa-arrow-right ml-2"></i>
                        </a>
                        <a href="/reservation" class="bg-pink-500 text-white font-bold text-base lg:text-lg flex items-center justify-center w-full sm:w-36 lg:w-48 hover:bg-pink-600 transition-colors px-2">
                            <span>来場予約</span><i class="fa-solid fa-arrow-right ml-2"></i>
                        </a>
                    </div>
                    <div class="lg:hidden flex items-center">
                        <button id="mobile-menu-button" aria-label="メニューを開く" class="text-white hover:opacity-80 focus:outline-none p-2 text-shadow">
                            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                        </button>
                    </div>
                </div>
            </div>
            <div id="mobile-menu" class="hidden lg:hidden bg-black/75 rounded-md shadow-lg">
                <div class="px-2 pt-2 pb-3 space-y-1">
                    <a href="/#products" class="block py-3 px-4 text-white font-semibold hover:bg-white/20 rounded text-base">ラインナップ</a>
                    <a href="/#columns" class="block py-3 px-4 text-white font-semibold hover:bg-white/20 rounded text-base">コラム</a>
                    <a href="/#faq" class="block py-3 px-4 text-white font-semibold hover:bg-white/20 rounded text-base">よくある質問</a>
                    <a href="/#access" class="block py-3 px-4 text-white font-semibold hover:bg-white/20 rounded text-base">アクセス</a>
                </div>
                <div class="p-4 space-y-3">
                    <a href="/contact" class="block text-center bg-white text-[#103f99] font-bold w-full text-lg hover:bg-gray-100 transition-colors rounded-md h-[58px] flex items-center justify-center shadow-md">お問い合わせ</a>
                    <a href="/reservation" class="block text-center bg-pink-500 text-white font-bold w-full text-lg hover:bg-pink-600 transition-colors rounded-md h-[58px] flex items-center justify-center shadow-md">来場予約</a>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow">
        <!-- Page Title -->
        <section class="bg-gray-100 py-12 border-b border-gray-200">
            <div class="container mx-auto px-4 text-center">
                <h1 class="text-3xl md:text-4xl font-black text-custom-blue mb-4 tracking-tight">Column & Interview</h1>
                <p class="text-gray-600 font-medium">Kokuban BASEからの発信。教育、技術、そして対話。</p>
            </div>
        </section>

        <!-- 1. New Arrivals -->
        <section id="new-arrivals" class="py-16 container mx-auto px-6 lg:px-8">
            <div class="flex items-center mb-10 gap-3 border-b border-gray-200 pb-4">
                <div class="w-1.5 h-8 bg-custom-blue"></div>
                <h2 class="text-2xl md:text-3xl font-bold text-custom-blue">新着記事</h2>
                <span class="text-sm text-gray-500 mt-1 ml-2 font-bold tracking-wide">New Arrivals</span>
            </div>
            
            <div id="new-arrivals-list" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="col-span-1 md:col-span-3 text-center py-10 text-gray-400">
                    <i class="fas fa-spinner fa-spin mr-2"></i>Loading...
                </div>
            </div>
        </section>

        <!-- 2. Interview -->
        <section id="interviews" class="py-16 bg-slate-100 border-y border-gray-200">
            <div class="container mx-auto px-6 lg:px-8">
                <div class="flex items-center mb-10 gap-3 border-b border-gray-300 pb-4">
                    <div class="w-1.5 h-8 bg-pink-500"></div>
                    <h2 class="text-2xl md:text-3xl font-bold text-custom-blue">対談記事</h2>
                    <span class="text-sm text-gray-500 mt-1 ml-2 font-bold tracking-wide">Special Interview</span>
                </div>

                <div id="interview-list" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="col-span-1 md:col-span-2 text-center py-10 text-gray-400">
                        <i class="fas fa-spinner fa-spin mr-2"></i>Loading...
                    </div>
                </div>
                
                <div class="mt-12 text-center">
                    <a href="#" class="inline-block px-8 py-3 bg-pink-500 text-white font-bold rounded-full hover:bg-pink-600 transition shadow-md hover:scale-105 transform">
                        対談記事をもっと見る <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
            </div>
        </section>

        <!-- 3. Regular Columns -->
        <section id="columns" class="py-16 container mx-auto px-6 lg:px-8">
            <div class="flex items-center mb-10 gap-3 border-b border-gray-200 pb-4">
                <div class="w-1.5 h-8 bg-custom-blue"></div>
                <h2 class="text-2xl md:text-3xl font-bold text-custom-blue">コラム</h2>
                <span class="text-sm text-gray-500 mt-1 ml-2 font-bold tracking-wide">Regular Columns</span>
            </div>

            <div id="column-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                 <div class="col-span-full text-center py-10 text-gray-400">
                    <i class="fas fa-spinner fa-spin mr-2"></i>Loading...
                 </div>
            </div>
             <div class="mt-12 text-center">
                <button class="bg-white text-custom-blue border-2 border-custom-blue px-8 py-3 rounded-full hover:bg-gray-50 transition shadow-md font-bold hover:scale-105 transform">
                    もっと読み込む <i class="fas fa-plus ml-2"></i>
                </button>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-custom-blue text-gray-200">
        <div class="container mx-auto px-6 py-12">
            <div class="flex flex-wrap justify-between">
                <div class="w-full md:w-1/4 mb-8 md:mb-0">
                    <h2 class="text-2xl font-bold text-white">Kokuban BASE</h2>
                    <p class="text-blue-200 mt-2">株式会社idea spot</p>
                </div>
                <div class="w-full md:w-3/4 flex flex-wrap justify-between">
                    <div class="w-full sm:w-1/2 lg:w-1/3 mb-8 sm:mb-0">
                        <h3 class="text-white font-semibold tracking-wider uppercase mb-4">メニュー</h3>
                        <ul>
                            <li class="mb-2"><a href="/#products" class="nav-link footer-link">ラインナップ</a></li>
                            <li class="mb-2"><a href="/#columns" class="nav-link footer-link">コラム</a></li>
                            <li class="mb-2"><a href="/#faq" class="nav-link footer-link">よくある質問</a></li>
                        </ul>
                    </div>
                    <div class="w-full sm:w-1/2 lg:w-1/3 mb-8 sm:mb-0">
                        <h3 class="text-white font-semibold tracking-wider uppercase mb-4">サポート</h3>
                        <ul>
                            <li class="mb-2"><a href="/reservation" class="footer-link">来場予約</a></li>
                            <li class="mb-2"><a href="/contact" class="footer-link">お問い合わせ</a></li>
                            <li class="mb-2"><a href="/#access" class="nav-link footer-link">アクセス</a></li>
                        </ul>
                    </div>
                    <div class="w-full sm:w-1/2 lg:w-1/3">
                        <h3 class="text-white font-semibold tracking-wider uppercase mb-4">会社情報</h3>
                        <ul>
                            <li class="mb-2"><a href="https://www.idea-spot.co.jp/" target="_blank" class="footer-link">企業概要</a></li>
                            <li class="mb-2"><a href="/privacy" class="footer-link">プライバシーポリシー</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="mt-12 pt-8 border-t border-white/20 text-center text-blue-200"><p>&copy; 2025 株式会社idea spot. All Rights Reserved.</p></div>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // Header / Mobile Menu
        const mmBtn = document.getElementById('mobile-menu-button');
        const mm = document.getElementById('mobile-menu');
        if(mmBtn && mm) {
            mmBtn.addEventListener('click', () => { 
                mm.classList.toggle('hidden'); 
                document.body.classList.toggle('overflow-hidden', !mm.classList.contains('hidden')); 
            });
        }

        // ---------------------------------------------------------
        // CMS Settings
        // ---------------------------------------------------------
        
        let rawDomain = '{{MICROCMS_SERVICE_DOMAIN}}';
        if(rawDomain.indexOf('{{') !== -1) rawDomain = '';
        const SERVICE_DOMAIN = rawDomain.replace('.microcms.io', '').replace('https://', '').replace('/', '').trim();

        const API_KEY = '{{MICROCMS_API_KEY}}';        
        const ENDPOINT = 'news'; 
        
        const USE_MOCK_DATA = !SERVICE_DOMAIN || !API_KEY || API_KEY.indexOf('{{') !== -1;

        async function fetchArticles(params = {}) {
            if (USE_MOCK_DATA) {
                console.log('Using Mock Data (Keys not set or placeholders detected)');
                return getMockData(params);
            }
            
            const url = new URL(`https://${SERVICE_DOMAIN}.microcms.io/api/v1/${ENDPOINT}`);
            Object.keys(params).forEach(key => url.searchParams.append(key, params[key]));
            
            console.log('Fetching from:', url.toString());

            try {
                const response = await fetch(url, {
                    headers: { 'X-MICROCMS-API-KEY': API_KEY }
                });
                
                if (!response.ok) {
                    console.error('API Error Status:', response.status);
                    if(response.status === 404) console.error('404 Not Found: ドメインIDかエンドポイント名(news)が間違っています。');
                    if(response.status === 401) console.error('401 Unauthorized: APIキーが間違っています。');
                    throw new Error('API Error: ' + response.statusText);
                }
                return await response.json();
            } catch (error) {
                console.error('Fetch error:', error);
                return { contents: [] }; 
            }
        }

        // --- メイン処理 ---
        document.addEventListener('DOMContentLoaded', async () => {
            // 全記事を一度に取得（最新50件まで）
            const allData = await fetchArticles({ limit: 50 });
            const allArticles = allData.contents || [];

            console.log('取得した全記事:', allArticles);
            
            // 記事内のカテゴリIDをリストアップ（デバッグ表示用）
            const categoryIdsFound = [...new Set(allArticles.map(a => {
                // 修正ポイント: 配列(チェックボックス)の場合の処理を最初に行う
                if(Array.isArray(a.category) && a.category.length > 0) return a.category[0];
                
                if(typeof a.category === 'string') return a.category;
                if(typeof a.category === 'object' && a.category && a.category.id) return a.category.id;
                
                return '未設定';
            }))];
            console.log('記事に含まれるカテゴリID一覧:', categoryIdsFound);


            // 1. New Arrivals (最新3件)
            renderArticles(allArticles.slice(0, 3), 'new-arrivals-list', 'standard');

            // 2. Interview (対談記事)
            // カテゴリIDが 'interview', 'taidan' 等のものを抽出
            const interviewArticles = allArticles.filter(article => {
                // 配列の中身をチェックするように修正
                const cats = Array.isArray(article.category) ? article.category : [article.category];
                
                // cats配列の中に、指定のIDが含まれているかチェック
                // ★もしデバッグ欄に違うIDが出たら、ここに追加してください
                return cats.some(c => 
                    c === 'interview' || c === 'taidan' || c === '対談記事' || 
                    (typeof c === 'object' && c.id === 'interview') // オブジェクトの場合
                );
            });
            // デバッグ情報を渡すために第4引数を追加
            renderArticles(interviewArticles.slice(0, 4), 'interview-list', 'interview', categoryIdsFound);

            // 3. Columns (コラム)
            const columnArticles = allArticles.filter(article => {
                const cats = Array.isArray(article.category) ? article.category : [article.category];
                
                // interviewを含まない記事をコラムとする
                const isInterview = cats.some(c => 
                    c === 'interview' || c === 'taidan' || c === '対談記事' ||
                    (typeof c === 'object' && c.id === 'interview')
                );
                return !isInterview;
            });
            renderArticles(columnArticles.slice(0, 8), 'column-list', 'standard', categoryIdsFound);
        });

        function renderArticles(articles, containerId, type, debugIds = []) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (!articles || articles.length === 0) {
                let msg = '記事が見つかりませんでした。';
                // 画面上に実際に取得できたIDを表示するデバッグ機能を追加
                if(!USE_MOCK_DATA) {
                     msg += '<br><br><div class="bg-gray-100 p-4 rounded text-left inline-block max-w-lg">';
                     msg += '<span class="text-sm font-bold text-red-600 block mb-2">【原因調査用データ】</span>';
                     msg += '<span class="text-xs text-gray-600">microCMSから届いた記事の「カテゴリID」は以下の通りです。<br>この中のどれかが対談記事のIDです。</span>';
                     msg += `<div class="mt-2 text-sm font-mono bg-white border border-gray-300 p-2 rounded">${debugIds.join(', ') || 'カテゴリIDが見つかりませんでした'}</div>`;
                     if (type === 'interview') {
                         msg += '<span class="text-xs text-blue-600 mt-2 block font-bold">↑ここに表示された英数字を教えてください！</span>';
                     }
                     msg += '</div>';
                }
                container.innerHTML = `<div class="col-span-full text-center text-gray-500 py-8">${msg}</div>`;
                return;
            }

            console.log(`Rendering ${containerId}:`, articles);

            articles.forEach(article => {
                const date = new Date(article.publishedAt).toLocaleDateString('ja-JP').replace(/\//g, '.');
                
                // --- カテゴリ情報の取得ロジック ---
                let categoryId = 'news';
                let categoryName = 'お知らせ';
                
                // 配列対応
                let rawCat = article.category;
                if (Array.isArray(rawCat) && rawCat.length > 0) {
                    rawCat = rawCat[0]; // 先頭のカテゴリを使用
                }

                if (rawCat) {
                    if (typeof rawCat === 'string') {
                        categoryId = rawCat;
                        categoryName = rawCat; // 一旦IDを入れる
                    } 
                    else if (typeof rawCat === 'object' && rawCat.id) {
                        categoryId = rawCat.id;
                        categoryName = rawCat.name || categoryId;
                    } 
                }

                // 表示名のマッピング
                // ★デバッグでIDが判明したらここに追加してください
                if (categoryId === 'interview' || categoryId === '対談記事' || categoryId === 'taidan') {
                    categoryName = '対談記事';
                    categoryId = 'interview'; 
                } else if (categoryId === 'column' || categoryId === 'コラム') {
                    categoryName = 'コラム';
                    categoryId = 'column'; 
                } else if (categoryId === 'news') {
                    categoryName = 'お知らせ';
                }

                let categoryClass = 'bg-gray-500';
                if (categoryId === 'interview') categoryClass = 'bg-pink-500';
                if (categoryId === 'column') categoryClass = 'bg-[#103f99]';

                // 画像フィールドの取得
                const imgField = article.eyecatch || article.thumbnail || article.main_image || article.image;
                const thumbnail = imgField ? imgField.url : 'https://placehold.co/600x400?text=No+Image';
                
                // リンク先URLの生成ロジック
                let linkUrl = article.url; 
                if (!linkUrl) {
                    if (article.slug) {
                        linkUrl = `/columns/${article.slug}/`;
                    } else {
                        linkUrl = `article.html?id=${article.id}`;
                    }
                }

                let cardHtml = '';

                if (type === 'interview') {
                    cardHtml = `
                        <article class="article-card bg-white rounded-xl shadow-sm overflow-hidden flex flex-col h-full border border-gray-100 group">
                            <a href="${linkUrl}" class="block img-container relative">
                                <img src="${thumbnail}" alt="${article.title}" class="w-full h-full object-cover">
                                <span class="absolute top-4 left-4 ${categoryClass} text-white text-xs font-bold px-3 py-1 rounded-full shadow-md">
                                    ${categoryName}
                                </span>
                            </a>
                            <div class="p-6 flex flex-col flex-grow">
                                <div class="text-sm text-gray-400 mb-2 flex items-center gap-2 font-bold">
                                    <i class="far fa-calendar-alt"></i> ${date}
                                </div>
                                <h3 class="text-xl font-bold mb-3 text-gray-800 line-clamp-2 group-hover:text-[#103f99] transition-colors">
                                    <a href="${linkUrl}">${article.title}</a>
                                </h3>
                                <p class="text-gray-600 text-sm line-clamp-3 mb-4 flex-grow leading-relaxed">
                                    ${article.summary || ''}
                                </p>
                                <div class="flex items-center gap-3 mt-auto pt-4 border-t border-gray-100">
                                     <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden">
                                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${article.id}" alt="Author" />
                                     </div>
                                     <span class="text-xs font-bold text-gray-500">Kokuban 編集部</span>
                                </div>
                            </div>
                        </article>
                    `;
                } else {
                    cardHtml = `
                        <article class="article-card bg-white rounded-lg shadow-sm overflow-hidden flex flex-col h-full group">
                            <a href="${linkUrl}" class="block img-container relative">
                                <img src="${thumbnail}" alt="${article.title}" class="w-full h-full object-cover">
                                <span class="absolute top-2 left-2 ${categoryClass} text-white text-[10px] font-bold px-2 py-1 rounded shadow-sm">
                                    ${categoryName}
                                </span>
                            </a>
                            <div class="p-5 flex flex-col flex-grow">
                                <div class="text-xs text-gray-400 mb-2 font-bold">${date}</div>
                                <h3 class="font-bold text-gray-800 mb-2 line-clamp-2 text-sm md:text-base group-hover:text-[#103f99] transition-colors">
                                    <a href="${linkUrl}">${article.title}</a>
                                </h3>
                            </div>
                        </article>
                    `;
                }
                container.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        function getMockData(params) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const allArticles = [
                        // モックデータ: チェックボックス（配列）形式に対応
                        { id: '1', slug: 'ict-future', title: 'ICT教育の未来', publishedAt: '2024-10-20', category: ['column'], eyecatch: { url: 'https://images.unsplash.com/photo-1509062522246-3755977927d7' } },
                        { id: '2', slug: 'teacher-interview', title: '【対談】現役教師が語る', publishedAt: '2024-10-18', category: ['interview'], eyecatch: { url: 'https://images.unsplash.com/photo-1544531320-94a523829032' }, summary: '...' },
                        { id: '3', slug: 'prog-edu', title: 'プログラミング教育', publishedAt: '2024-10-15', category: ['column'], eyecatch: { url: 'https://images.unsplash.com/photo-1517694712202-14dd9538aa97' } },
                    ];
                    let results = [...allArticles];
                    resolve({ contents: results });
                }, 500);
            });
        }
    </script>
</body>
</html>
